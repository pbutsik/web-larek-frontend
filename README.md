# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## UML-схема
![UML](./src/images/Larek_MVP.png "UML")

## Данные и типы данных, используемые в приложении

Интерфейс карточек товаров

```
export interface IProduct {
	id: string;
	title: string;
	description: string;
	image: string;
	category: 'софт-скил'| 'другое'| 'дополнительное'| 'кнопка';
	price: number | null;
	ordered: boolean;
	addToBasket: () => void;
	deleteFromBasket: () => void;
}
```

Интерфейс формы c оплатой и контактами
```
export interface IOrderForm {
	payment: IPaymentType;
	address: string;
	email: string;
	phone: string;
}
```

Интерфейс формы

```
export interface IOrder extends IOrderForm {
   items: IProduct[];
   validation(): void;
   clearOrder(): void;
   postOrder(): void; 
}
```

Интерфейс состояния приложения

```
export interface IAppState {
	catalog: IProduct[];
	basket: IProduct[];
	order: IOrder;
	preview: IProduct;
	checkLotBasket(): boolean;
	clearBasket(): void;
	Total(): number;
	BasketIds(): number;
	BasketLen(): number;
	initOrder(): IOrder;
}
```
## Краткое описание возможностей приложения

Главная страница содержит каталог товаров, предоставляет доступ к детальной информации о товаре и к корзине с выбранными товарами. При нажатии на кнопку «Купить» товар добавляется в корзину, если не был добавлен в корзину раньше, при нажатии на кнопку «Убрать» товар удаляется из корзины.

Оформление товара состоит из последовательного ввода информации в двух модальных окнах. В первом окне производится выбор способа оплаты и ввод адреса доставки. Если адрес доставки не введён, появляется сообщение об ошибке. Во втором окне осуществляется ввод почты и телефона покупателя. Если одно из полей не заполнено, также появляется сообщение об ошибке. При нажатии на кнопку оплаты появляется сообщение об успешной оплате и товары удаляются из корзины.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.
Взаимодействие внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения. Код, описывающий взаимодействие представления и данных между собой находится в файле index.ts, выполняющем роль презентера. 

Список событий:

```
export enum TypesOfEvents {
	DownloadProducts = 'catalog:changed', // подгружаем доступные карточки	
	OpenProduct = 'card:open', // открываем карточку для просмотра
	OpenModal = 'modal:open', // блокировка при открытии модального окна
	CloseModal = 'modal:close', // снятие блокировки при закрытии модального окна
	OpenBasket = 'basket:open', // открываем корзину
	ChangeInBasketPtoducts = 'product:changed', // добавляем/удаляем карточку из корзины
	Validation = 'form:changed', // проверяем форму 
	OpenPayment = 'order_payment:open', // начинаем оформление заказа
	SubmitPaymentAdressForm = 'order:submit', // заполнили первую форму с оплатой и адресом
	OpenUserContacts = 'order_contacts:open', // продолжаем оформление заказа
	SubmitUserContactsForm = 'contacts:submit', // заполнили вторую форму с контактами
	SelectPayment = 'payment:changed', // выбираем способ оплаты
	ChangeInputAddress = 'order.address:change', // изменили адрес доставки
	ChangeInputEmail = 'contacts.email:change', // изменили почту для связи
	ChangeInputPhone = 'contacts.phone:change', // изменили телефон для связи
	PostOrder = 'order:post', // завершаем заказ
}
```

### Базовый код

#### Класс Api

constructor(baseUrl: string, options: RequestInit = {})
- baseUrl: string - домен
- options: RequestInit -  параметры запроса

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

#### Класс Component<T>

constructor(container: HTMLElement, protected events: IEvents)
- container: HTMLElement - объект контейнера, DOM элемент
- events: IEvents - брокер событий

Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.\
Методы:
- `toggleClass` - переключить класс
- `setText` - установить текстовое содержимое
- `setDisabled` - сменить статус блокировки
- `setHidden` - скрыть елемент
- `setVisible` - показать елеиент
- `setImage` - установить изображение с алтернативным текстом
- `render` - вернуть корневой DOM-элемент

#### Model<T>

constructor(data: Partial<T>, protected events: IEvents)
- data: Partial<T> - используемые моделью данные
- events: IEvents - объект брокера событий

Базовый абстракный класс для компонентов модели данных. Связывает переданные данные со свойствами объекта и инициализирует вызов именованных событий через метод emitChanges.\
Методы:
- emitChanges - сообщение об изменении в модели

### Слой данных (Model)

#### Класс AppState extends Model<IAppState>

constructor(data: Partial<IAppState>, events: IEvents)
- data: Partial<IAppState> - используемые моделью данные
- events: IEvents - объект брокера событий

Класс данных отвечает за хранение и логику работы с данными корзины, продуктов и заказа.\
В полях класса хранятся следующие данные:
- basket - отслеживание выбранных карточек в корзине
- catalog - отслеживание списка доступных карточет продуктов
- order - отслеживает состояние заказа
- preview - отслеживает продукт в модальном окне

Методы:
- `checkProductBasket: boolean` - проверяет наличие продукта в корзине
- `clearBasket: void` - очищает корзину
- `Total: number` - возвращает полную стоимость продуктов в корзине
- `BasketIds: string[]` - возвращает индексы продуктов находящихся в корзине
- `BasketLen: number` - возвращает количество продуктов находящихся в корзине
- `initOrder: IOrder` - инициализация объекта заказа
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс Product extends Model<IProduct>

Класс данных продукта. Структура определяется ответом сервера. Свойства и методы реализуют логику взаимодействия с корзиной. \
В полях класса хранятся следующие данные:
- id - идентификатор продукта
- title - заголовок
- description - описание
- image - путь до файла картинки
- category -  категория продукта
- price - цена
- ordered - признак наличия товара в заказе

Методы:
- `addToBasket: void` - добавить в корзину товар
- `deleteFromBasket: void` - удалить из корзины товар

#### Класс Order extends Model<IOrder>

Класс данных заказа. Содержит свойства, которые отображаются на полях соответствующих форм. Производит валидацию полей формы.
В полях класса хранятся следующие данные:
- payment - тип платежа
- address - адрес
- email - почта
- phone - телефон
- items - объекты продуктов в корзине

Методы:
- `validation: void` - проверка полей формы
- `clearOrder: void` - очистка полей формы
- `postOrder: void` - событие завершения оформления заказа
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

### Классы представления (View)

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page extends Component<IPage>

constructor(container: HTMLElement, events: IEvents)
- container: HTMLElement - родительский контейнер для вывода элементов
- events: IEvents - объект брокера событий

Класс представления основной страницы. Отвечает за отображение блока с карточками на главной странице. В конструктор принимает контейнер, в котором размещаются карточки. \
В полях класса хранятся следующие данные:
- counter - количество элементов в корзине
- gallery - список товаров для отображения
- wrapper - блокирует прокрутку страницы
- basket - кнопка для отображения корзины

- `set counter` - количество лотов в корзине
- `set galery` - обновить список карточек
- `set locked` - блокировка страницы

#### Класс Card extends Component<ICard>

constructor(container: HTMLElement, events: IEvents, actions?: IActions)
- container: HTMLElement - элемент разметки для вставки карточки
- events: IEvents - объект брокера событий
- actions?: IActions - доступные события

Класс представления карточки. Отвечает за отображение карточки, задавая в карточке данные названия товара, категории, изображения, стоимости, описания товара. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр EventEmitter для инициации событий.\

В полях класса хранятся следующие данные:
- category - категория
- title - заголовок
- image - путь до файла картинки
- description - описание
- button - текст кнопки добавления в заказ
- price - стоимость

#### Класс Form<T> extends Component<IFormState>

constructor(protected container: HTMLFormElement, events: IEvents)
- container: HTMLFormElement - элемент разметки
- events: IEvents - объект брокера событий

Класс представления формы. Родительский класс для всех форм в приложении. Содержит общие методы для форм. Наследуется от Component\
В полях класса хранятся следующие данные:
- submit - кнопка подтверждения формы
- errors - блок отображения ошибок

В данном классе на весь контейнер отображение привязываем событие отслеживание input, для вызова событий вида `container.field:change` и событие `container:submit`

#### Класс Modal extends Component<IModalData>

constructor(container: HTMLElement, events: IEvents)
- container: HTMLElement - родительский контейнер для отображения внутреннего содержания модального окна
- events: IEvents - объект брокера событий

Класс представления модального окна. Предоставляет методы open и close для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.\
В полях класса хранятся следующие данные:
- closeButton - отображение кнопки закрытия
- content - отображение содержания модального окна

Методы:
- `open: void` - открыть модальное окно
- `close: void` - закрыть модальное окно

#### Класс DeliveryForm extends Form<IOrderForm>

constructor(container: HTMLFormElement, events: IEvents)
- container: HTMLFormElement - элемент разметки
- events: IEvents - объект брокера событий

Класс представления формы с информацией о способе оплаты и адресом доставки. \
В полях класса хранятся следующие данные:
- paymentContainer - элементы формы
- paymentButtons - элементы формы

#### Класс ContactsForm extends Form<IOrderForm>

constructor(container: HTMLFormElement, events: IEvents)
- container: HTMLFormElement - элемент разметки
- events: IEvents - объект брокера событий

Класс представления отображения формы оформления заказа с контактной информацией.\
Методы:
- `set phone` - задать телефон
- `set email` - задать почту

#### Класс Basket extends Component<IBasketView> 

constructor(container: HTMLElement, events: EventEmitter)
- container: HTMLElement - контейнер для вставки куда выводится список товаров
- events: EventEmitter - объект брокера событий

Класс представления корзины. Отвечает за отображение списка товаров, добавленных в корзину\
В полях класса хранятся следующие данные:
- list - список элементов в корзине
- total - стоимсоть корзины
- button - кнопка открытия формы оформления заказа

#### Класс BasketItem extends Component<IBasketCard>

constructor(container: HTMLElement, events: IEvents, actions?: ICardActions)
- container: HTMLElement - контейнер для вставки данных отображения элементов карточек
- events: IEvents - объект брокера событий
- actions?: ICardActions - доступные события

Класс представления элементов корзины. Отвечает за отображение элемента карточки товара в корзине\
В полях класса хранятся следующие данные:
- index - номер товара в корзине
- title - название товара в корзине
- price - стоимость товара в корзине
- deleteBtn - кнопка удаления из корзины

#### Класс Success extends Component<ISuccess>

constructor(container: HTMLElement, events: IEvents, actions: IActions)
- container: HTMLElement - элемент разметки
- events: IEvents - объект брокера событий
- actions: IActions - доступные события

Класс представления информации оформленного заказа. Отвечает за отображение окна успешного подтверждения заказа\
В полях класса хранятся следующие данные:
- total - общая стоимость заказа

### WebLarekAPI

constructor(cdn: string, baseUrl: string, options?: RequestInit)
- cdn: string - используемый домен со статикой
- baseUrl: string - используемый домен приложения
- options?: RequestInit - параметры запроса

Класс взаимодействия с конкретным API-сервером.\
Методы:

- `getProduct: Promise<IProduct>` - для чтения информации по конкретному лоту
- `getProductList: Promise<IProduct[]>` - для чтения информации по всем доступным лотам
- `postOrderProducts: Promise<IOrderResult>` - оформления заказа через соответствующий запрос на сервер


[Ссылка на проект](https://github.com/pbutsik/web-larek-frontend)

UML схема приложена ./src/images/Larek_MVP.png